<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Carbon Footprint | Securemove</title>
        <style>
    body {
        font-family: 'Segoe UI', Arial, sans-serif;
        padding: 2rem;
        background: linear-gradient(135deg, #f0f8ff 0%, #dbeafe 100%);
        min-height: 100vh;
        transition: background 0.7s;
    }
    h1 {
        color: #2575fc;
        letter-spacing: 2px;
        text-shadow: 0 2px 8px rgba(37,117,252,0.08);
        animation: fadeInDown 1s;
    }
    label, select, input {
        display: block;
        margin-top: 1rem;
        font-size: 1.1rem;
        font-weight: bold;
        opacity: 0;
        animation: fadeInUp 0.7s forwards;
        animation-delay: 0.3s;
    }
    select, input[type="number"] {
        padding: 0.4rem;
        margin-top: 0.3rem;
        width: 220px;
        font-size: 1rem;
        border: 1px solid #b6d0fc;
        border-radius: 6px;
        background: #fff;
        box-shadow: 0 1px 4px rgba(37,117,252,0.04);
        transition: border 0.3s, box-shadow 0.3s;
    }
    select:focus, input[type="number"]:focus {
        border: 1.5px solid #2575fc;
        box-shadow: 0 2px 8px rgba(37,117,252,0.12);
        outline: none;
    }
    button {
        margin-top: 1.5rem;
        padding: 0.5rem 1.2rem;
        font-size: 1rem;
        background: linear-gradient(90deg, #2575fc 0%, #6a11cb 100%);
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(37,117,252,0.13);
        transition: background 0.3s, transform 0.2s, box-shadow 0.3s;
        font-weight: 600;
        letter-spacing: 1px;
        opacity: 0;
        animation: fadeInUp 0.7s forwards;
        animation-delay: 0.5s;
    }
    button:hover {
        background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
        transform: translateY(-2px) scale(1.04);
        box-shadow: 0 4px 16px rgba(37,117,252,0.18);
    }
    .result-box {
        margin-top: 2rem;
        padding: 1.2rem;
        background: linear-gradient(90deg, #e3f7ff 60%, #f0f8ff 100%);
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(37,117,252,0.09);
        font-size: 1.2rem;
        color: #2575fc;
        border-left: 6px solid #2575fc;
        opacity: 0;
        transform: translateY(20px);
        animation: fadeInResult 0.8s forwards;
        animation-delay: 0.7s;
    }
    #bookingDetails {
        transition: background 0.4s, box-shadow 0.4s;
        background: #f8fafc;
        border-radius: 8px;
        padding: 0.8rem 1rem;
        margin-top: 1.2rem;
        box-shadow: 0 1px 6px rgba(37,117,252,0.06);
        opacity: 0;
        animation: fadeInUp 0.7s forwards;
        animation-delay: 0.4s;
    }

    @keyframes fadeInDown {
        from { opacity: 0; transform: translateY(-30px);}
        to { opacity: 1; transform: translateY(0);}
    }
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px);}
        to { opacity: 1; transform: translateY(0);}
    }
    @keyframes fadeInResult {
        from { opacity: 0; transform: translateY(20px);}
        to { opacity: 1; transform: translateY(0);}
    }
</style>
    </head>
    <body>
        <h1>Your Carbon Footprint</h1>
        <button onclick="window.location.href='dashboard.html'"
            style="position:absolute; top:24px; right:32px; background:#fff; color:#2575fc; border:1.5px solid #2575fc; border-radius:20px; padding:0.4rem 1.1rem; font-weight:600; font-size:1rem; box-shadow:0 2px 8px rgba(37,117,252,0.08); cursor:pointer; transition:background 0.2s, color 0.2s;">←
            Back to Dashboard</button>

        <label for="bookingSelect">Select a Booking:</label>
        <select id="bookingSelect">
            <option value>Loading bookings...</option>
        </select>

        <div id="bookingDetails"
            style="margin-top: 1rem; font-size: 1.1rem;"></div>

        <div id="inputFields" style="display:none;">
            <label for="distanceInput">Enter Distance (km):</label>
            <input type="number" id="distanceInput" min="1"
                placeholder="e.g., 50" />

            <label for="weightInput">Enter Weight (kg):</label>
            <input type="number" id="weightInput" min="1"
                placeholder="e.g., 100" />

            <button id="calculateBtn">Calculate CO₂ Footprint</button>
        </div>

        <div id="carbonSummary" class="result-box" style="display:none;"></div>

        <script type="module">

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const bookingSelect = document.getElementById('bookingSelect');
    const inputFields = document.getElementById('inputFields');
    const distanceInput = document.getElementById('distanceInput');
    const weightInput = document.getElementById('weightInput');
    const calculateBtn = document.getElementById('calculateBtn');
    const carbonSummary = document.getElementById('carbonSummary');
    const bookingDetails = document.getElementById('bookingDetails');

    let userBookings = [];

    onAuthStateChanged(auth, (user) => {
      if (user) {
        const userEmail = user.email.toLowerCase();
        const bookingsRef = ref(db, 'Orders');

        onValue(bookingsRef, (snapshot) => {
          userBookings = [];
          bookingSelect.innerHTML = '<option value="">-- Select a Booking --</option>';

          snapshot.forEach((childSnapshot) => {
            const booking = childSnapshot.val();
            if (booking.email && booking.email.toLowerCase() === userEmail) {
              userBookings.push(booking);
            }
          });

          if (userBookings.length === 0) {
            bookingSelect.innerHTML = '<option value="">No bookings found</option>';
          } else {
            userBookings.forEach((booking, index) => {
              const option = document.createElement('option');
              option.value = index;
              option.textContent = `Booking ${index + 1}`;
              bookingSelect.appendChild(option);
            });
          }
        });
      } else {
        window.location.href = "signuplogin.html";
      }
    });

    bookingSelect.addEventListener('change', () => {
      const selectedIndex = bookingSelect.value;
      if (selectedIndex === "") {
        inputFields.style.display = 'none';
        carbonSummary.style.display = 'none';
        bookingDetails.innerHTML = '';
      } else {
        const selectedBooking = userBookings[selectedIndex];
        bookingDetails.innerHTML = `
          <strong>Pickup:</strong> ${selectedBooking.pickup_address || 'N/A'}<br>
          <strong>Dropoff:</strong> ${selectedBooking.dropoff_address || 'N/A'}
        `;
        inputFields.style.display = 'block';
        carbonSummary.style.display = 'none';
      }
    });

    calculateBtn.addEventListener('click', () => {
      const distance = parseFloat(distanceInput.value);
      const weight = parseFloat(weightInput.value);
      const CO2_PER_KM_PER_KG = 0.21;

      if (isNaN(distance) || isNaN(weight) || distance <= 0 || weight <= 0) {
        alert("Please enter valid numbers for both distance and weight.");
        return;
      }

      const carbon = distance * weight * CO2_PER_KM_PER_KG;

      carbonSummary.innerHTML = `
        Estimated CO₂ Emissions: <strong>${carbon.toFixed(2)} kg</strong>
      `;
      carbonSummary.style.display = 'block';
    });
  </script>
    </body>
</html>
