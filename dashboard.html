<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Customer Dashboard | Securemove</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f7f7f7;
      margin: 0;
      padding: 0;
      color: #333;
    }

    header {
      background-color: #2575fc;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
    }

    header .logo img {
      height: 50px;
    }

    .navbar {
      list-style: none;
      display: flex;
      gap: 2rem;
    }

    .navbar li {
      display: inline;
    }

    .navbar a {
      color: white;
      text-decoration: none;
      font-size: 1.1rem;
      font-weight: 600;
      transition: color 0.3s ease;
    }

    .navbar a:hover {
      color: #f1f1f1;
    }

    .header-btn a {
      background-color: #f9b115;
      color: white;
      padding: 10px 20px;
      border-radius: 30px;
      font-weight: 600;
      text-decoration: none;
      transition: background-color 0.3s ease;
    }

    .header-btn a:hover {
      background-color: #d88a00;
    }

    .dashboard-container {
      padding: 2rem;
      max-width: 1100px;
      margin: auto;
      background: white;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      margin-top: 2rem;
    }

    .welcome {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 1rem;
      color: #333;
    }

    .loyalty-points {
      background-color: #e3f7ff;
      padding: 1.5rem;
      border-radius: 10px;
      margin-bottom: 1.5rem;
      font-size: 1.2rem;
      font-weight: 500;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .loyalty-points span {
      font-size: 1.4rem;
      font-weight: 700;
      color: #2575fc;
    }

    /* Export Proof Certificate Section */
    .export-certificates {
      margin-bottom: 2rem;
    }

    .certificate-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 2rem;
      border-radius: 15px;
      color: white;
      margin-bottom: 1.5rem;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
      position: relative;
      overflow: hidden;
    }

    .certificate-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(-30px, -30px); }
    }

    .certificate-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      position: relative;
      z-index: 1;
    }

    .certificate-header h3 {
      font-size: 1.8rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .certificate-header i {
      font-size: 2rem;
    }

    .certificate-badge {
      background: rgba(255, 255, 255, 0.2);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      backdrop-filter: blur(10px);
    }

    .certificate-body {
      position: relative;
      z-index: 1;
    }

    .certificate-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .info-item {
      background: rgba(255, 255, 255, 0.15);
      padding: 1rem;
      border-radius: 10px;
      backdrop-filter: blur(10px);
    }

    .info-item strong {
      display: block;
      font-size: 0.85rem;
      opacity: 0.9;
      margin-bottom: 0.3rem;
    }

    .info-item span {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .certificate-actions {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      position: relative;
      z-index: 1;
    }

    .cert-btn {
      background: white;
      color: #667eea;
      padding: 12px 24px;
      border-radius: 25px;
      font-weight: 600;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      font-size: 1rem;
    }

    .cert-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }

    .cert-btn i {
      font-size: 1.2rem;
    }

    h2 {
      font-size: 1.8rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #333;
    }

    .booking {
      background-color: #f9f9f9;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      margin-bottom: 1.5rem;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .booking:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .booking h3 {
      font-size: 1.5rem;
      color: #2575fc;
      margin-bottom: 1rem;
    }

    .booking p {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 15px;
      font-size: 0.9rem;
      font-weight: 600;
      margin-top: 0.5rem;
    }

    .status-delivered {
      background: #d4edda;
      color: #155724;
    }

    .status-transit {
      background: #cce5ff;
      color: #004085;
    }

    .status-pending {
      background: #fff3cd;
      color: #856404;
    }

    .export-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-left: 10px;
    }

    /* Print styles for certificate */
    @media print {
      body * {
        visibility: hidden;
      }
      .certificate-print, .certificate-print * {
        visibility: visible;
      }
      .certificate-print {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        background: white;
        padding: 2rem;
      }
      .cert-btn {
        display: none;
      }
    }

    @media (max-width: 768px) {
      .navbar {
        flex-direction: column;
        gap: 1rem;
      }

      header {
        flex-direction: column;
        align-items: flex-start;
      }

      .header-btn {
        margin-top: 1rem;
      }

      .dashboard-container {
        padding: 1.5rem;
      }

      .loyalty-points {
        flex-direction: column;
        align-items: flex-start;
      }

      .booking {
        padding: 1rem;
      }

      .certificate-info {
        grid-template-columns: 1fr;
      }

      .certificate-actions {
        flex-direction: column;
      }

      .cert-btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>

  <header>
    <a href="#" class="logo"><img src="img/logo.jpg" alt="Logo"></a>
    <ul class="navbar">
      <li><a href="index.html">Home</a></li>
      <li><a href="index.html#services">Services</a></li>
      <li><a href="index.html#about">About</a></li>
      <li><a href="index.html#reviews">Reviews</a></li>
      <li><a href="issuesanderrors.html">Support</a></li>
    </ul>
    <div class="header-btn">
      <a href="#" id="logoutBtn" class="login">Logout</a>
    </div>
  </header>

  <section class="dashboard-container">
    <p class="welcome" id="welcomeUser">Welcome, User</p>
    <div class="loyalty-points">
      Loyalty Points: <span id="loyaltyPoints">0</span>
    </div>

    <!-- Export Certificates Section -->
    <div id="exportCertificatesContainer" class="export-certificates"></div>

    <h2>Your Bookings</h2>
    <div id="bookingsContainer"></div>

    <div style="text-align: right; margin-bottom: 1.5rem;">
      <a href="carbonfoot.html" class="header-btn" style="text-decoration:none;">
        <span style="background-color:#2575fc; color:white; padding:10px 24px; border-radius:30px; font-weight:600; transition:background-color 0.3s;">View Carbon Footprint</span>
      </a>
    </div>

  </section>

  <script type="module">

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const welcomeUser = document.getElementById("welcomeUser");
    const loyaltyPoints = document.getElementById("loyaltyPoints");
    const bookingsContainer = document.getElementById("bookingsContainer");
    const exportCertificatesContainer = document.getElementById("exportCertificatesContainer");

    function getModeIcon(mode) {
      if (mode === 'air') return 'bxs-plane-alt';
      if (mode === 'sea') return 'bxs-ship';
      if (mode === 'courier') return 'bxs-car';
      return 'bx-package';
    }

    function getModeName(mode) {
      if (mode === 'air') return 'Air Freight';
      if (mode === 'sea') return 'Sea Freight';
      if (mode === 'courier') return 'International Courier';
      return 'Unknown';
    }

    function formatText(text) {
      if (!text) return 'N/A';
      return text.charAt(0).toUpperCase() + text.slice(1).replace(/-/g, ' ');
    }

    function generateCertificateNumber(orderId) {
      const date = new Date();
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      return `SMEX-${year}${month}-${String(orderId).padStart(6, '0')}`;
    }

    function downloadCertificate(order) {
      const certNumber = generateCertificateNumber(order.orderId);
      const deliveredDate = new Date().toLocaleDateString('en-ZA', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });

      // Create certificate as a text file with all details
      const certificateText = 
        '笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊申n' +
        '                    沍 PROOF OF EXPORT\n' +
        '            Certificate of International Shipment\n' +
        '                Securemove Logistics (Pty) Ltd\n' +
        '笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊申n\n' +
        'Certificate No: ' + certNumber + '\n\n' +
        'This is to certify that the following goods have been\n' +
        'successfully exported from the Republic of South Africa:\n\n' +
        '笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏\n' +
        'SHIPMENT DETAILS\n' +
        '笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏\n\n' +
        'Order Reference:        #' + order.orderId + '\n' +
        'Exporter Name:          ' + order.name + '\n' +
        'Email:                  ' + order.email + '\n' +
        'Transport Mode:         ' + getModeName(order.transportMode) + '\n' +
        'Origin:                 ' + formatText(order.originCity) + ', South Africa\n' +
        'Destination:            ' + order.destinationCountry + ', ' + formatText(order.destinationContinent) + '\n' +
        'Cargo Type:             ' + formatText(order.cargoType) + '\n' +
        'Total Weight:           ' + order.weight + ' kg\n' +
        'Booking Date:           ' + new Date(order.bookingDate).toLocaleDateString('en-ZA') + '\n' +
        'Delivery Date:          ' + deliveredDate + '\n' +
        'Tracking Number:        ' + (order.allocation?.trackingNumber || 'N/A') + '\n\n' +
        '笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏\n' +
        'COMPLIANCE STATEMENT\n' +
        '笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏\n\n' +
        'This shipment has been processed in accordance with all\n' +
        'applicable South African export regulations and international\n' +
        'shipping standards.\n\n' +
        '笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏\n\n' +
        'Authorized Officer                    Date\n' +
        'Securemove Logistics                  ' + deliveredDate + '\n\n' +
        '笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊申n' +
        'Securemove Logistics (Pty) Ltd | Reg No: 2023/123456/07\n' +
        '123 Logistics Avenue, Durban, 4001, South Africa\n' +
        'Tel: +27 79 386 8100 | Email: info@securemove.co.za\n' +
        '笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊絶武笊申n';

      // Download as text file
      const blob = new Blob([certificateText], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'Export_Certificate_' + certNumber + '.txt';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      alert('Certificate downloaded successfully!\n\nYou can print this text file or convert it to PDF using your preferred tool.');
    }

    function printCertificate(order) {
      const certNumber = generateCertificateNumber(order.orderId);
      const deliveredDate = new Date().toLocaleDateString('en-ZA', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });

      // Create a simple printable view using a div
      const printDiv = document.createElement('div');
      printDiv.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:99999;padding:40px;overflow:auto;';
      
      printDiv.innerHTML = 
        '<style>@media print{body *{visibility:hidden}#printContent,#printContent *{visibility:visible}#printContent{position:absolute;left:0;top:0;width:100%}}</style>' +
        '<div id="printContent" style="font-family:Georgia,serif;max-width:800px;margin:0 auto;border:10px double #667eea;padding:40px;">' +
        '<div style="text-align:center;margin-bottom:30px;border-bottom:3px solid #667eea;padding-bottom:20px;">' +
        '<h1 style="color:#667eea;font-size:2.5rem;margin:0;">沍 PROOF OF EXPORT</h1>' +
        '<p style="color:#666;font-size:1.2rem;margin:10px 0;">Certificate of International Shipment</p>' +
        '<p style="font-size:1rem;color:#999;">Securemove Logistics (Pty) Ltd</p>' +
        '</div>' +
        '<div style="text-align:center;font-size:1.1rem;color:#764ba2;font-weight:bold;margin:20px 0;">Certificate No: ' + certNumber + '</div>' +
        '<p>This certifies that the following goods have been successfully exported:</p>' +
        '<div style="margin:30px 0;padding:20px;background:#f8f9ff;border-left:5px solid #667eea;">' +
        '<table style="width:100%;border-collapse:collapse;">' +
        '<tr><td style="padding:10px;border-bottom:1px solid #ddd;font-weight:bold;color:#667eea;width:40%;">Order Reference</td><td style="padding:10px;border-bottom:1px solid #ddd;">#' + order.orderId + '</td></tr>' +
        '<tr><td style="padding:10px;border-bottom:1px solid #ddd;font-weight:bold;color:#667eea;">Exporter Name</td><td style="padding:10px;border-bottom:1px solid #ddd;">' + order.name + '</td></tr>' +
        '<tr><td style="padding:10px;border-bottom:1px solid #ddd;font-weight:bold;color:#667eea;">Transport Mode</td><td style="padding:10px;border-bottom:1px solid #ddd;">' + getModeName(order.transportMode) + '</td></tr>' +
        '<tr><td style="padding:10px;border-bottom:1px solid #ddd;font-weight:bold;color:#667eea;">Origin</td><td style="padding:10px;border-bottom:1px solid #ddd;">' + formatText(order.originCity) + ', South Africa</td></tr>' +
        '<tr><td style="padding:10px;border-bottom:1px solid #ddd;font-weight:bold;color:#667eea;">Destination</td><td style="padding:10px;border-bottom:1px solid #ddd;">' + order.destinationCountry + ', ' + formatText(order.destinationContinent) + '</td></tr>' +
        '<tr><td style="padding:10px;border-bottom:1px solid #ddd;font-weight:bold;color:#667eea;">Cargo Type</td><td style="padding:10px;border-bottom:1px solid #ddd;">' + formatText(order.cargoType) + '</td></tr>' +
        '<tr><td style="padding:10px;border-bottom:1px solid #ddd;font-weight:bold;color:#667eea;">Weight</td><td style="padding:10px;border-bottom:1px solid #ddd;">' + order.weight + ' kg</td></tr>' +
        '<tr><td style="padding:10px;border-bottom:1px solid #ddd;font-weight:bold;color:#667eea;">Delivery Date</td><td style="padding:10px;border-bottom:1px solid #ddd;">' + deliveredDate + '</td></tr>' +
        '</table></div>' +
        '<div style="margin-top:40px;display:flex;justify-content:space-between;">' +
        '<div style="text-align:center;"><div style="border-top:2px solid #333;width:200px;margin:0 auto 10px;"></div><p><strong>Authorized Officer</strong></p></div>' +
        '<div style="text-align:center;"><div style="border-top:2px solid #333;width:200px;margin:0 auto 10px;"></div><p><strong>Date: ' + deliveredDate + '</strong></p></div>' +
        '</div></div>' +
        '<div style="text-align:center;margin-top:20px;"><button onclick="window.print();document.body.removeChild(this.parentElement.parentElement);" style="background:#667eea;color:white;padding:12px 24px;border:none;border-radius:5px;cursor:pointer;font-size:16px;">Print Certificate</button> ' +
        '<button onclick="document.body.removeChild(this.parentElement.parentElement);" style="background:#6c757d;color:white;padding:12px 24px;border:none;border-radius:5px;cursor:pointer;font-size:16px;margin-left:10px;">Close</button></div>';

      document.body.appendChild(printDiv);
    }

    onAuthStateChanged(auth, (user) => {
      if (user) {
        const userEmail = user.email;
        welcomeUser.textContent = `Welcome, ${user.displayName || user.email}`;

        // Fetch standard bookings
        const bookingsRef = ref(db, 'Orders');
        onValue(bookingsRef, (snapshot) => {
          bookingsContainer.innerHTML = '';
          let found = false;
          let totalPoints = 0;

          snapshot.forEach((childSnapshot) => {
            const booking = childSnapshot.val();

            if (booking.email && booking.email.toLowerCase() === userEmail.toLowerCase()) {
              found = true;

              const points = parseInt(booking.loyalty_points) || 0;
              totalPoints += points;

              let statusClass = 'status-pending';
              if (booking.status === 'Delivered') statusClass = 'status-delivered';
              else if (booking.status === 'In Transit') statusClass = 'status-transit';

              bookingsContainer.innerHTML += `
                <div class="booking">
                  <h3>Booking ID: ${childSnapshot.key}</h3>
                  <p><strong>Name:</strong> ${booking.name}</p>
                  <p><strong>Pickup Address:</strong> ${booking.pickup_address}</p>
                  <p><strong>Pickup Date:</strong> ${booking.pickup_date}</p>
                  <p><strong>Dropoff Address:</strong> ${booking.dropoff_address}</p>
                  <p><strong>Dropoff Date:</strong> ${booking.dropoff_date}</p>
                  <p><strong>Price:</strong> R${booking.total_price}</p>
                  <p><strong>Loyalty Points Earned:</strong> ${booking.loyalty_points}</p>
                  <p><strong>Status:</strong> <span class="status-badge ${statusClass}">${booking.status}</span></p>
                </div>
              `;
            }
          });

          if (!found) {
            bookingsContainer.innerHTML = '<p>No bookings found for your account.</p>';
          }

          loyaltyPoints.textContent = totalPoints;
          localStorage.setItem("totalLoyaltyPoints", totalPoints);
        });

        // Fetch export bookings
        const exportRef = ref(db, 'ExportOrders');
        onValue(exportRef, (snapshot) => {
          exportCertificatesContainer.innerHTML = '';
          let deliveredExports = [];

          snapshot.forEach((childSnapshot) => {
            const order = childSnapshot.val();

            if (order.email && order.email.toLowerCase() === userEmail.toLowerCase()) {
              // Show certificate only for delivered export orders
              if (order.status === 'Delivered') {
                deliveredExports.push(order);
              }

              // Add to bookings list
              let statusClass = 'status-pending';
              if (order.status === 'Delivered') statusClass = 'status-delivered';
              else if (order.status === 'In Transit') statusClass = 'status-transit';
              else if (order.status === 'Approved') statusClass = 'status-transit';

              const modeIcon = getModeIcon(order.transportMode);
              const modeName = getModeName(order.transportMode);

              bookingsContainer.innerHTML += `
                <div class="booking">
                  <h3>
                    Booking ID: ${order.orderId}
                    <span class="export-badge"><i class='bx ${modeIcon}'></i> Export</span>
                  </h3>
                  <p><strong>Name:</strong> ${order.name}</p>
                  <p><strong>Transport:</strong> ${modeName}</p>
                  <p><strong>Origin:</strong> ${formatText(order.originCity)}, South Africa</p>
                  <p><strong>Destination:</strong> ${order.destinationCountry}, ${formatText(order.destinationContinent)}</p>
                  <p><strong>Cargo:</strong> ${formatText(order.cargoType)} (${order.weight} kg)</p>
                  <p><strong>Total Cost:</strong> ${order.pricing?.total || 'N/A'}</p>
                  <p><strong>Status:</strong> <span class="status-badge ${statusClass}">${order.status}</span></p>
                </div>
              `;
            }
          });

          // Display certificates for delivered exports
          if (deliveredExports.length > 0) {
            deliveredExports.forEach(order => {
              const certNumber = generateCertificateNumber(order.orderId);
              const modeIcon = getModeIcon(order.transportMode);

              exportCertificatesContainer.innerHTML += `
                <div class="certificate-card">
                  <div class="certificate-header">
                    <h3><i class='bx bx-certification'></i> Proof of Export Available</h3>
                    <span class="certificate-badge">Order #${order.orderId}</span>
                  </div>
                  <div class="certificate-body">
                    <div class="certificate-info">
                      <div class="info-item">
                        <strong>Certificate Number</strong>
                        <span>${certNumber}</span>
                      </div>
                      <div class="info-item">
                        <strong>Transport Mode</strong>
                        <span><i class='bx ${modeIcon}'></i> ${getModeName(order.transportMode)}</span>
                      </div>
                      <div class="info-item">
                        <strong>Destination</strong>
                        <span>${order.destinationCountry}</span>
                      </div>
                      <div class="info-item">
                        <strong>Delivery Date</strong>
                        <span>${new Date().toLocaleDateString('en-ZA')}</span>
                      </div>
                    </div>
                    <div class="certificate-actions">
                      <button class="cert-btn" onclick="window.downloadCert_${order.orderId}()">
                        <i class='bx bx-download'></i> Download Certificate
                      </button>
                      <button class="cert-btn" onclick="window.printCert_${order.orderId}()">
                        <i class='bx bx-printer'></i> Print Certificate
                      </button>
                      <button class="cert-btn" onclick="window.viewCert_${order.orderId}()">
                        <i class='bx bx-show'></i> View Details
                      </button>
                    </div>
                  </div>
                </div>
              `;

              // Create global functions for each certificate
              window[`downloadCert_${order.orderId}`] = () => downloadCertificate(order);
              window[`printCert_${order.orderId}`] = () => printCertificate(order);
              window[`viewCert_${order.orderId}`] = () => {
                alert(`Certificate Number: ${certNumber}\n\nOrder: #${order.orderId}\nExporter: ${order.name}\nDestination: ${order.destinationCountry}\nCargo: ${order.weight}kg ${formatText(order.cargoType)}\n\nYou can download or print this certificate using the buttons above.`);
              };
            });
          }
        });

      } else {
        window.location.href = "signuplogin.html";
      }
    });

    document.getElementById("logoutBtn").addEventListener("click", async () => {
      await signOut(auth);
      window.location.href = "signuplogin.html";
    });
  </script>
</body>
</html>


